# 技術選定書：Homecare Manager

> **バージョン**: 1.0.0  
> **作成日**: 2024-12-24  
> **ステータス**: 提案

---

## 1. 技術スタック概要

### 1.1 推奨構成（フルスタック TypeScript）

```
┌─────────────────────────────────────────────────────────────┐
│                       フロントエンド                         │
│  Next.js 14 (App Router) + TypeScript + Tailwind CSS       │
│  + shadcn/ui (UIコンポーネント)                             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       バックエンド                           │
│  Next.js API Routes (Server Actions)                        │
│  + Prisma (ORM)                                             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       データベース                           │
│  PostgreSQL (Supabase または ローカル)                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                         認証                                │
│  NextAuth.js (Auth.js)                                      │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 各技術の選定理由

### 2.1 フロントエンド

| 技術 | 選定理由 |
|------|---------|
| **Next.js 14** | フロント・バックエンド統合、学習リソース豊富、本番運用実績多数 |
| **TypeScript** | 型安全、エラー早期発見、VSCode補完が優秀 |
| **Tailwind CSS** | ユーティリティファースト、デザインシステム構築が容易 |
| **shadcn/ui** | 高品質UIコンポーネント、カスタマイズ自由、アクセシビリティ対応 |

### 2.2 バックエンド

| 技術 | 選定理由 |
|------|---------|
| **Next.js API Routes** | フロントと同一プロジェクト、デプロイが簡単 |
| **Prisma** | TypeScript対応ORM、マイグレーション管理、型安全なDB操作 |

### 2.3 データベース

| 技術 | 選定理由 |
|------|---------|
| **PostgreSQL** | 信頼性、機能豊富、Prismaとの相性◎ |
| **Supabase** | PostgreSQLホスティング、無料枠あり、認証機能も提供 |

### 2.4 認証

| 技術 | 選定理由 |
|------|---------|
| **NextAuth.js** | Next.js公式推奨、メール/パスワード認証対応、セッション管理簡単 |

### 2.5 PDF出力

| 技術 | 選定理由 |
|------|---------|
| **@react-pdf/renderer** | React componentでPDF生成、日本語対応 |

### 2.6 カレンダー

| 技術 | 選定理由 |
|------|---------|
| **FullCalendar** または **react-big-calendar** | 高機能、ドラッグ&ドロップ対応、カスタマイズ可能 |

---

## 3. インフラ・デプロイ

### 3.1 開発環境

| 項目 | ツール |
|------|--------|
| エディタ | VS Code + Cursor |
| パッケージ管理 | npm または pnpm |
| バージョン管理 | Git + GitHub |
| ローカルDB | Docker (PostgreSQL) または Supabase |

### 3.2 本番環境（推奨）

| 項目 | サービス | 費用 |
|------|---------|------|
| ホスティング | **Vercel** | 無料枠あり |
| データベース | **Supabase** | 無料枠あり（500MB） |
| メール送信 | **Resend** または **SendGrid** | 無料枠あり |

### 3.3 代替構成（AWS）

| 項目 | サービス |
|------|---------|
| ホスティング | AWS Amplify または EC2 |
| データベース | Amazon RDS (PostgreSQL) |
| メール送信 | Amazon SES |

---

## 4. プロジェクト構成

```
homecare-manager/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (auth)/            # 認証関連ページ
│   │   │   ├── login/
│   │   │   └── logout/
│   │   ├── (dashboard)/       # メイン画面
│   │   │   ├── calendar/      # カレンダー
│   │   │   ├── events/        # イベント管理
│   │   │   ├── patients/      # 患者管理
│   │   │   ├── facilities/    # 施設管理
│   │   │   ├── reminders/     # リマインド
│   │   │   ├── pdf/           # PDF出力
│   │   │   └── settings/      # 設定
│   │   ├── api/               # API Routes
│   │   └── layout.tsx
│   ├── components/            # 共通コンポーネント
│   │   ├── ui/               # shadcn/ui
│   │   ├── calendar/
│   │   ├── events/
│   │   └── ...
│   ├── lib/                   # ユーティリティ
│   │   ├── prisma.ts         # Prismaクライアント
│   │   ├── auth.ts           # 認証設定
│   │   └── utils.ts
│   └── types/                 # 型定義
├── prisma/
│   ├── schema.prisma         # DBスキーマ
│   └── migrations/           # マイグレーション
├── public/                    # 静的ファイル
├── .env                       # 環境変数
├── package.json
├── tailwind.config.js
└── tsconfig.json
```

---

## 5. 主要ライブラリ一覧

### 5.1 package.json（想定）

```json
{
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0",
    "typescript": "^5.0.0",
    
    "@prisma/client": "^5.0.0",
    "next-auth": "^5.0.0",
    
    "@react-pdf/renderer": "^3.0.0",
    "react-big-calendar": "^1.0.0",
    "date-fns": "^3.0.0",
    
    "tailwindcss": "^3.0.0",
    "@radix-ui/react-*": "各種",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.0.0",
    "lucide-react": "^0.0.0",
    
    "zod": "^3.0.0",
    "react-hook-form": "^7.0.0"
  },
  "devDependencies": {
    "prisma": "^5.0.0",
    "@types/node": "^20.0.0",
    "@types/react": "^18.0.0",
    "eslint": "^8.0.0",
    "prettier": "^3.0.0"
  }
}
```

---

## 6. 開発スケジュール目安

### Phase 1: MVP（6〜8週間）

| 週 | タスク |
|----|--------|
| 1 | 環境構築、DB設計、Prismaスキーマ作成 |
| 2 | 認証機能（ログイン、ユーザー管理） |
| 3 | 患者/施設マスタ管理 |
| 4 | イベント管理（CRUD） |
| 5 | カレンダー表示、リスト表示 |
| 6 | 確定機能、PDF出力 |
| 7 | リマインド機能 |
| 8 | テスト、バグ修正、デプロイ |

---

## 7. セキュリティ対策

| 対策 | 実装方法 |
|------|---------|
| パスワードハッシュ | bcrypt（NextAuth.jsに組み込み） |
| CSRF対策 | NextAuth.jsのCSRFトークン |
| XSS対策 | React自動エスケープ、DOMPurify |
| SQLインジェクション | Prismaのパラメータ化クエリ |
| 認証状態管理 | NextAuth.jsセッション |
| HTTPS | Vercel自動SSL |

---

## 8. 今後の拡張性

この構成であれば、以下の拡張も容易です：

| 拡張 | 対応方法 |
|------|---------|
| OS通知（Push） | Web Push API + Service Worker |
| オフライン対応 | PWA化（next-pwa） |
| 多店舗対応 | Prismaスキーマに店舗テーブル追加 |
| モバイルアプリ | React Native または Capacitor |

---

## 9. 代替案

### 9.1 よりシンプルな構成（学習コスト低）

| 項目 | 代替技術 |
|------|---------|
| バックエンド | Supabase（BaaS）を直接利用 |
| 認証 | Supabase Auth |
| メリット | バックエンド実装不要、即座に開始可能 |
| デメリット | カスタマイズ性に制限あり |

### 9.2 エンタープライズ構成

| 項目 | 代替技術 |
|------|---------|
| バックエンド | NestJS（別プロジェクト） |
| データベース | Amazon RDS |
| メリット | スケーラビリティ、マイクロサービス化可能 |
| デメリット | 複雑、学習コスト高 |

---

## 10. 結論・推奨

**初心者にもおすすめ、かつ本格的なシステムを構築できる「Next.js + Prisma + Supabase」構成を推奨します。**

### 推奨理由

1. **学習リソースが豊富**: 日本語情報も多い
2. **フルスタック**: フロント・バック統合で管理しやすい
3. **無料で始められる**: Vercel + Supabaseの無料枠で運用可能
4. **拡張性**: 将来のスケールアップにも対応
5. **型安全**: TypeScriptで開発効率とバグ削減

---

## 改訂履歴

| バージョン | 日付 | 変更内容 | 担当 |
|-----------|------|---------|------|
| 1.0.0 | 2024-12-24 | 初版作成 | - |

---

*以上*

